#include <stdlib.h>
#include <stdio.h>
#include <math.h>
#include <printf.h>
#include "../../../../../superh/port/logmarkers.h"


#define side_length 20

float lookup_table[side_length][side_length] = {
{0.6738861229968898, 0.6802605958024904, 0.687844863491655, 0.6966377552388283, 0.7066383735365367, 0.7178458067730707, 0.7302591156696631, 0.7438773197026879, 0.7586993835108778, 0.7747242032875459, 0.7919505931578071, 0.8103772715407931, 0.8300028474968498, 0.8508258070597113, 0.8728444995536425, 0.8960571238955433, 0.9204617148820052, 0.946056129461312, 0.9728380329903813, 1.0008048854766318, },
{4.076253549795728, 4.111878084454037, 4.1548761265591985, 4.205207634424457, 4.262834062125478, 4.327716376691154, 4.399814590290462, 4.479087291902717, 4.5654911784709595, 4.65898058553821, 4.759507017366307, 4.86701867653709, 4.981459993035648, 5.102771152815345, 5.230887625844404, 5.365739693633736, 5.507251976245775, 5.655342958784032, 5.8099245173631315, 5.9709014445590185, },
{7.675282941020346, 7.737149194231333, 7.8129980047931396, 7.902695423504973, 8.00611003776321, 8.123108804200871, 8.25355548249091, 8.39730906741996, 8.55422221923166, 8.724139692238653, 8.906896761702342, 9.102317648979563, 9.31021394493526, 9.530383031620227, 9.762606502213103, 10.006648579225667, 10.262254530970553, 10.529149086290495, 10.807034847548232, 11.095590701876102, },
{11.475202449877383, 11.56032566962268, 11.666493735481012, 11.793423562453473, 11.940835462197711, 12.1084462987827, 12.29596617773317, 12.503095131417753, 12.729519800779002, 12.974910113403341, 13.238915957929112, 13.521163854790784, 13.821253623297507, 14.138755045044018, 14.473204523652134, 14.824101740840838, 15.190906308823148, 15.573034419027787, 15.969855487143894, 16.380688794486748, },
{15.467769300859558, 15.573114286169531, 15.707004325714594, 15.868952293918657, 16.05847513928053, 16.27508387671737, 16.518277889259668, 16.78753922345359, 17.082326878467544, 17.402071088899596, 17.746167601282572, 18.113971944283527, 18.50479369259449, 18.917890724510965, 19.35246347319525, 19.807649171621087, 20.282516091196506, 20.77605777406155, 21.287187259057724, 21.814731301365764, },
{19.656998116267513, 19.779556523842132, 19.938605531114575, 20.133398935278727, 20.363195103412142, 20.627243312243678, 20.924775018365814, 21.254995118806637, 21.617073201956703, 22.01013478884563, 22.43325256476356, 22.88543760122245, 23.365630568252286, 23.87269293702716, 24.405398172816305, 24.962422918255076, 25.542338166930872, 26.143600427279054, 26.7645428767839, 27.40336650647948, },
{24.047757873872694, 24.184535148983176, 24.36620325924772, 24.591701517008715, 24.859974118933888, 25.16995233928077, 25.520542120152104, 25.910611648047226, 26.33897891670235, 26.804399276212745, 27.305552968429694, 27.841032648625117, 28.40933089341697, 29.008827694948057, 29.637777941311445, 30.294298883215276, 30.976357586879924, 31.681758373160296, 32.408130242886486, 33.15291428841531, },
{28.630524149038205, 28.778494893425332, 28.98019317664734, 29.234189100753454, 29.539057784510586, 29.89335692523203, 30.295610068584303, 30.744289859918872, 31.237801277119353, 31.774464844954593, 32.35249983092811, 32.97000742261431, 33.62495388647214, 34.31515370812632, 35.03825271410692, 35.791711175037584, 36.57278689026287, 37.3785182539051, 38.20570730234139, 39.050902743090965, },
{33.4099523886295, 33.56610825899324, 33.785273709213364, 34.06559459439308, 34.405221737136074, 34.80228336877493, 35.254863434596146, 35.76097987510772, 36.318562883336966, 36.92543313814622, 37.579280013554055, 38.277639764049674, 39.01787368588812, 39.79714625435383, 40.61240323698033, 41.46034978271362, 42.337428487006825, 43.23979743283364, 44.163308207608644, 45.10348389600131, },
{38.39155239498282, 38.552889033883986, 38.78697343479176, 39.091471618904556, 39.46405434374507, 39.90236392826727, 40.403986942926466, 40.96642686959111, 41.58707673128092, 42.263191691715754, 42.99186162465955, 43.76998365304379, 44.59423465785525, 45.46104375677182, 46.366564752531566, 47.30664855101886, 48.27681554905234, 49.27222799185884, 50.28766230021815, 51.317481367262324, },
{43.56451809433167, 43.728019906221434, 43.97444267935744, 44.30091805492885, 44.70458199781564, 45.18253552223513, 45.73181112826437, 46.34933920129856, 47.03191437442638, 47.7761618537032, 48.578503706302925, 49.43512511152943, 50.3419405746686, 51.294560103661404, 52.2882553485794, 53.31792570388322, 54.37806437344487, 55.462724398314684, 56.565484647214134, 57.67941576973461, },
{48.940082854101355, 49.10273894521808, 49.35894630554785, 49.70524648973203, 50.1381847811156, 50.654264321349416, 51.249905641392324, 51.92140614782336, 52.66489956444142, 53.47631532912914, 54.35133794595789, 55.2853662925109, 56.273472882401606, 57.31036308296368, 58.39033428809026, 59.50723504619891, 60.65442414329927, 61.82472964114028, 63.01040787041418, 64.20310237899356, },
{54.50658601320776, 54.665387324325096, 54.92880426211316, 55.29273386814099, 55.75307613663126, 56.30568106574222, 56.946300646056265, 57.670540796049394, 58.473813244514716, 59.35128735991239, 60.29784192661869, 61.30801686804682, 62.37596491661233, 63.49540323051532, 64.65956495731251, 65.86115074425159, 67.09228019534038, 68.34444327512342, 69.6084516591389, 70.87439003102779, },
{60.269751136739956, 60.421689324557846, 60.68975283384488, 61.06913915644485, 61.5550477791957, 62.14261966772666, 62.82688106829986, 63.60268724759265, 64.46466617038863, 65.40716211514543, 66.42417922740702, 67.50932501102889, 68.65575375718386, 69.8561099111162, 71.1024713766127, 72.386292758158, 73.6983485407425, 75.0286762072903, 76.36651929367595, 77.7002703812967, },
{66.23615614525777, 66.3782105133042, 66.64835845748055, 67.04104203402952, 67.5507041535829, 68.17171999929622, 68.89833198797184, 69.72458465936025, 70.64425949360198, 71.65080965677379, 72.73729467450136, 73.89631503360182, 75.11994671171932, 76.39967563491558, 77.72633206317967, 79.09002490381873, 80.48007595269335, 81.88495406325985, 83.29220924338293, 84.68840667988086, },
{72.39285872854752, 72.52203002030652, 72.79169574121191, 73.19548826471802, 73.72703949759244, 74.3799037517056, 75.14748322954149, 76.0229534274221, 76.99918845640374, 78.06868628080262, 79.2234938743071, 80.45513229363418, 81.75452166968823, 83.11190611617855, 84.51677855565427, 85.95780546291347, 87.42275152574406, 88.89840422295404, 90.37049831964872, 91.82364027971171, },
{78.74622327626304, 78.85950314843458, 79.12612364010968, 79.53885240530144, 80.09045512865076, 80.77360936170663, 81.58081988869078, 82.50433399880116, 83.53605666500611, 84.66746562928124, 85.88952639424039, 87.19260712111272, 88.56639343401795, 89.99980313049075, 91.48090079820682, 92.99681233786194, 94.53363939215576, 96.07637368083196, 97.60881124172685, 99.11346657777726, },
{85.30346853352901, 85.3978264869306, 85.65883126119061, 86.0783297256676, 86.6481650941252, 87.36008122573143, 88.2056272149068, 89.17606187581154, 90.26225812141777, 91.45460723711204, 92.74292304877409, 94.11634598527706, 95.56324703535583, 97.07113159878722, 98.62654323182988, 100.0, 100.0, 100.0, 100.0, 100.0, },
{92.05037054100208, 92.12281712182823, 92.37564787208801, 92.79973480863568, 93.38594442662861, 94.12503198615742, 95.00753469338214, 96.02366476370919, 97.16320236694797, 98.41538845438649, 99.76881746772477, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, },
{99.00158055168443, 99.04907872443015, 99.29115939378099, 99.71766353929353, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, },
};

float step_sizes[2] = {921.3684210526316, 21066.947368421053, };

float convert(float input[2]) {
    input[0] -= 12749;
    input[1] -= 293804;

    int lower_bound0;
    int lower_bound1;

    int difference0 = modff(input[0]/step_sizes[0], &lower_bound0);
    int difference1 = modff(input[1]/step_sizes[1], &lower_bound1);

    float base = lookup_table[lower_bound0][lower_bound1];
    float result = base;
    if (difference0 > 0) {
        result += (lookup_table[lower_bound0 + 1][lower_bound1] - base)*difference0;
    }
    if (difference1 > 0) {
        result += (lookup_table[lower_bound0][lower_bound1 + 1] - base)*difference1;
    }
    return result;
}

int main() {
    float input[2] = {12749, 293804, };
    LOGMARK(0);
    float result = convert(input);
    LOGMARK(1);
    printf("result = %f\n", result);
	printf("expected_result = %f\n", 0.6738861229968898);
    return 0;
}