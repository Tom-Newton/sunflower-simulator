#include <stdlib.h>
#include <stdio.h>
#include <math.h>
#include <printf.h>
#include "../../../../../superh/port/logmarkers.h"


#define side_length 10

float lookup_table[side_length][side_length] = {
{0.6738861229968898, 0.6887622704802228, 0.709024883520454, 0.7346651142449772, 0.7656730215167227, 0.8020396368253978, 0.8437522094745128, 0.8907951848880977, 0.943153344911504, 1.0008048854766318, },
{8.090006929245035, 8.243707278125495, 8.462414678144032, 8.744743430661817, 9.0892243522525, 9.494261799470765, 9.958014322855735, 10.478338985569385, 11.052759238922887, 11.67832131446259, },
{16.383209989206257, 16.64972893965371, 17.048510499518354, 17.574448280898984, 18.222140339429107, 18.98568029955954, 19.858303729008487, 20.832154162448333, 21.89809251988285, 23.045297510471492, },
{25.553495302880556, 25.906827255064865, 26.467312347643425, 27.223779664956467, 28.164420983046533, 29.276295137091726, 30.54462042793277, 31.952240715524937, 33.4791531877914, 35.10173347350334, },
{35.60086287026793, 36.015002224358966, 36.718820222519234, 37.69273758283428, 38.91606628310479, 40.366106312067316, 42.016964419628586, 43.838598644799205, 45.79594124264853, 47.84762920355813, },
{46.52531269136839, 46.974253847536005, 47.80303412414578, 48.981322034532425, 50.47707623960387, 52.255113824486315, 54.27533570409592, 56.491227950271124, 58.848456684454234, 61.282984700635865, },
{58.326844766181914, 58.784582124595985, 59.71995405252308, 61.08953302005088, 62.84745085254377, 64.94331767434872, 67.3197342813348, 69.91012863194071, 72.63669951320853, 75.40779996473654, },
{71.00545909470851, 71.44598705553891, 72.46958000765113, 74.01737053938966, 76.0271901219245, 78.43071786165453, 81.1501601513452, 84.09530068980796, 87.16066972891142, 90.22207499586017, },
{84.5611556769482, 84.95846864036477, 86.0519119895299, 87.76483459254877, 90.01629404774606, 92.71731438640376, 95.76661331412716, 99.04674412387286, 100.0, 100.0, },
{99.00158055168443, 99.3296306401797, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, 100.0, },
};

float step_sizes[2] = {1945.111111111111, 44474.666666666664, };

float convert(float input[2]) {
    input[0] -= 12749;
    input[1] -= 293804;

    int lower_bound0;
    int lower_bound1;

    int difference0 = modff(input[0]/step_sizes[0], &lower_bound0);
    int difference1 = modff(input[1]/step_sizes[1], &lower_bound1);

    float base = lookup_table[lower_bound0][lower_bound1];
    float result = base;
    if (difference0 > 0) {
        result += (lookup_table[lower_bound0 + 1][lower_bound1] - base)*difference0;
    }
    if (difference1 > 0) {
        result += (lookup_table[lower_bound0][lower_bound1 + 1] - base)*difference1;
    }
    return result;
}

int main() {
    float input[2] = {12749, 293804, };
    LOGMARK(0);
    float result = convert(input);
    LOGMARK(1);
    printf("result = %f\n", result);
	printf("expected_result = %f\n", 0.6738861229968898);
    return 0;
}